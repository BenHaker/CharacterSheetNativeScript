"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var metadatasource_1 = require("./metadatasource");
var CharacterLogic = (function () {
    function CharacterLogic(character) {
        var _this = this;
        this.getAttributeModifier = function (attribute) {
            var attrValue;
            if (attribute == null || _this.character == null)
                return 0;
            if (_this.character[attribute] == null)
                return 0;
            attrValue = _this.character[attribute];
            if (typeof (attrValue) == "string")
                attrValue = parseInt(attrValue);
            switch (attrValue) {
                case 2:
                case 3:
                    return -3;
                case 4:
                case 5:
                    return -2;
                case 6:
                case 7:
                case 8:
                    return -1;
                case 9:
                case 10:
                case 11:
                case 12:
                    return 0;
                case 13:
                case 14:
                case 15:
                    return 1;
                case 16:
                case 17:
                    return 2;
                case 18:
                    return 3;
                default:
                    return 0;
            }
        };
        this.getTHAC0 = function () {
            var level = _this.character.level;
            switch (_this.character.class) {
                case metadatasource_1.Class.Fighter:
                case metadatasource_1.Class.Dwarf:
                case metadatasource_1.Class.Elf:
                case metadatasource_1.Class.Halfling:
                    return 19 - (Math.ceil(level / 3) - 1) * 2;
                case metadatasource_1.Class.Cleric:
                case metadatasource_1.Class.Thief:
                    return 19 - (Math.ceil(level / 4) - 1) * 2;
                case metadatasource_1.Class.MagicUser:
                    return 19 - (Math.ceil(level / 5) - 1) * 2;
                default:
                    return 19;
            }
        };
        this.getAttackBonus = function () {
            return 20 - _this.getTHAC0();
        };
        this.getReverseAC = function () {
            return 20 - _this.character.ac;
        };
        this.isValidLevel = function (level) {
            if (level < 1)
                return false;
            return level <= _this.getMaxLevel();
        };
        this.getMaxLevel = function () {
            switch (_this.character.class) {
                case metadatasource_1.Class.Dwarf:
                    return 12;
                case metadatasource_1.Class.Elf:
                    return 10;
                case metadatasource_1.Class.Halfling:
                    return 8;
                case metadatasource_1.Class.Cleric:
                case metadatasource_1.Class.Fighter:
                case metadatasource_1.Class.MagicUser:
                case metadatasource_1.Class.Thief:
                    return 36;
            }
            return 36;
        };
        this.getClasses = function () {
            return metadatasource_1.MetaDataService.getClasses();
        };
        this.getSave = function (saveType) {
            return metadatasource_1.MetaDataService.getSaves(_this.character.class, _this.character.level, saveType);
        };
        this.getSpellSlots = function (spellLevel) {
            return metadatasource_1.MetaDataService.getSpellSlots(_this.character.class, _this.character.level, spellLevel);
        };
        this.getAbilities = function () {
            return metadatasource_1.MetaDataService.getAbilities(_this.character.class, _this.character.level);
        };
        this.character = character;
    }
    return CharacterLogic;
}());
exports.CharacterLogic = CharacterLogic;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcmFjdGVybG9naWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjaGFyYWN0ZXJsb2dpYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLG1EQUE2RTtBQUU3RTtJQUdJLHdCQUFZLFNBQW9CO1FBQWhDLGlCQUVDO1FBRUQseUJBQW9CLEdBQUcsVUFBQyxTQUFpQjtZQUNyQyxJQUFJLFNBQWlCLENBQUM7WUFFdEIsRUFBRSxDQUFBLENBQUMsU0FBUyxJQUFJLElBQUksSUFBSSxLQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQztnQkFDM0MsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNiLEVBQUUsQ0FBQSxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDO2dCQUNqQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2IsU0FBUyxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdEMsRUFBRSxDQUFBLENBQUMsT0FBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLFFBQVEsQ0FBQztnQkFDN0IsU0FBUyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUEsQ0FBQyxTQUFTLENBQUMsQ0FDakIsQ0FBQztnQkFDRyxLQUFLLENBQUMsQ0FBQztnQkFDUCxLQUFLLENBQUM7b0JBQ0YsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNkLEtBQUssQ0FBQyxDQUFDO2dCQUNQLEtBQUssQ0FBQztvQkFDRixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2QsS0FBSyxDQUFDLENBQUM7Z0JBQ1AsS0FBSyxDQUFDLENBQUM7Z0JBQ1AsS0FBSyxDQUFDO29CQUNGLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDZCxLQUFLLENBQUMsQ0FBQztnQkFDUCxLQUFLLEVBQUUsQ0FBQztnQkFDUixLQUFLLEVBQUUsQ0FBQztnQkFDUixLQUFLLEVBQUU7b0JBQ0gs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LENBQUMsQ0FBQTtRQUVELFlBQU8sR0FBRyxVQUFDLFFBQWtCO1lBQ3pCLE1BQU0sQ0FBQyxnQ0FBZSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxLQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMxRixDQUFDLENBQUE7UUFFRCxrQkFBYSxHQUFHLFVBQUMsVUFBa0I7WUFDL0IsTUFBTSxDQUFDLGdDQUFlLENBQUMsYUFBYSxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLEtBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ2pHLENBQUMsQ0FBQTtRQUVELGlCQUFZLEdBQUc7WUFDWCxNQUFNLENBQUMsZ0NBQWUsQ0FBQyxZQUFZLENBQUMsS0FBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsS0FBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNwRixDQUFDLENBQUE7UUEzR0csSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFDL0IsQ0FBQztJQTJHTCxxQkFBQztBQUFELENBQUMsQUFoSEQsSUFnSEM7QUFoSFksd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFyYWN0ZXIgfSBmcm9tICcuL2RhdGFzb3VyY2UnO1xyXG5pbXBvcnQgeyBDbGFzcywgU2F2ZVR5cGUsIE1ldGFEYXRhU2VydmljZSwgQWJpbGl0eSB9IGZyb20gJy4vbWV0YWRhdGFzb3VyY2UnO1xyXG5cclxuZXhwb3J0IGNsYXNzIENoYXJhY3RlckxvZ2ljIHtcclxuICAgIHByaXZhdGUgY2hhcmFjdGVyOiBDaGFyYWN0ZXI7XHJcbiAgICBcclxuICAgIGNvbnN0cnVjdG9yKGNoYXJhY3RlcjogQ2hhcmFjdGVyKSB7XHJcbiAgICAgICAgdGhpcy5jaGFyYWN0ZXIgPSBjaGFyYWN0ZXI7XHJcbiAgICB9XHJcbiAgICAgICBcclxuICAgIGdldEF0dHJpYnV0ZU1vZGlmaWVyID0gKGF0dHJpYnV0ZTogc3RyaW5nKTogbnVtYmVyID0+IHtcclxuICAgICAgICBsZXQgYXR0clZhbHVlOiBudW1iZXI7XHJcblxyXG4gICAgICAgIGlmKGF0dHJpYnV0ZSA9PSBudWxsIHx8IHRoaXMuY2hhcmFjdGVyID09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIGlmKHRoaXMuY2hhcmFjdGVyW2F0dHJpYnV0ZV0gPT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgYXR0clZhbHVlID0gdGhpcy5jaGFyYWN0ZXJbYXR0cmlidXRlXTtcclxuICAgICAgICBpZih0eXBlb2YoYXR0clZhbHVlKSA9PSBcInN0cmluZ1wiKVxyXG4gICAgICAgICAgICBhdHRyVmFsdWUgPSBwYXJzZUludChhdHRyVmFsdWUpO1xyXG4gICAgICAgIHN3aXRjaChhdHRyVmFsdWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMztcclxuICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICBjYXNlIDU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTI7XHJcbiAgICAgICAgICAgIGNhc2UgNjpcclxuICAgICAgICAgICAgY2FzZSA3OlxyXG4gICAgICAgICAgICBjYXNlIDg6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgIGNhc2UgOTpcclxuICAgICAgICAgICAgY2FzZSAxMDpcclxuICAgICAgICAgICAgY2FzZSAxMTpcclxuICAgICAgICAgICAgY2FzZSAxMjpcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICBjYXNlIDEzOlxyXG4gICAgICAgICAgICBjYXNlIDE0OlxyXG4gICAgICAgICAgICBjYXNlIDE1OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIGNhc2UgMTY6XHJcbiAgICAgICAgICAgIGNhc2UgMTc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMjtcclxuICAgICAgICAgICAgY2FzZSAxODpcclxuICAgICAgICAgICAgICAgIHJldHVybiAzO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldFRIQUMwID0gKCkgPT4ge1xyXG4gICAgICAgIGxldCBsZXZlbCA9IHRoaXMuY2hhcmFjdGVyLmxldmVsO1xyXG4gICAgICAgIHN3aXRjaCh0aGlzLmNoYXJhY3Rlci5jbGFzcykge1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkZpZ2h0ZXI6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRHdhcmY6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRWxmOlxyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkhhbGZsaW5nOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE5IC0gKE1hdGguY2VpbChsZXZlbCAvIDMpIC0gMSkgKiAyO1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkNsZXJpYzpcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5UaGllZjpcclxuICAgICAgICAgICAgICAgIHJldHVybiAxOSAtIChNYXRoLmNlaWwobGV2ZWwgLyA0KSAtIDEpICogMjtcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5NYWdpY1VzZXI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTkgLSAoTWF0aC5jZWlsKGxldmVsIC8gNSkgLSAxKSAqIDI7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldEF0dGFja0JvbnVzID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiAyMCAtIHRoaXMuZ2V0VEhBQzAoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRSZXZlcnNlQUMgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIDIwIC0gdGhpcy5jaGFyYWN0ZXIuYWM7XHJcbiAgICB9XHJcblxyXG4gICAgaXNWYWxpZExldmVsID0gKGxldmVsOiBudW1iZXIpOiBib29sZWFuID0+IHtcclxuICAgICAgICBpZihsZXZlbCA8IDEpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gbGV2ZWwgPD0gdGhpcy5nZXRNYXhMZXZlbCgpXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TWF4TGV2ZWwgPSAoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoKHRoaXMuY2hhcmFjdGVyLmNsYXNzKSB7ICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkR3YXJmOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDEyO1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkVsZjpcclxuICAgICAgICAgICAgICAgIHJldHVybiAxMDtcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5IYWxmbGluZzpcclxuICAgICAgICAgICAgICAgIHJldHVybiA4O1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkNsZXJpYzpcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5GaWdodGVyOlxyXG4gICAgICAgICAgICBjYXNlIENsYXNzLk1hZ2ljVXNlcjpcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5UaGllZjpcclxuICAgICAgICAgICAgICAgIHJldHVybiAzNjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDM2O1xyXG4gICAgfVxyXG5cclxuICAgIGdldENsYXNzZXMgPSAoKTogc3RyaW5nW10gPT4ge1xyXG4gICAgICAgIHJldHVybiBNZXRhRGF0YVNlcnZpY2UuZ2V0Q2xhc3NlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNhdmUgPSAoc2F2ZVR5cGU6IFNhdmVUeXBlKTogbnVtYmVyID0+IHtcclxuICAgICAgICByZXR1cm4gTWV0YURhdGFTZXJ2aWNlLmdldFNhdmVzKHRoaXMuY2hhcmFjdGVyLmNsYXNzLCB0aGlzLmNoYXJhY3Rlci5sZXZlbCwgc2F2ZVR5cGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNwZWxsU2xvdHMgPSAoc3BlbGxMZXZlbDogbnVtYmVyKTogbnVtYmVyID0+IHtcclxuICAgICAgICByZXR1cm4gTWV0YURhdGFTZXJ2aWNlLmdldFNwZWxsU2xvdHModGhpcy5jaGFyYWN0ZXIuY2xhc3MsIHRoaXMuY2hhcmFjdGVyLmxldmVsLCBzcGVsbExldmVsKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRBYmlsaXRpZXMgPSAoKTogQWJpbGl0eVtdID0+IHtcclxuICAgICAgICByZXR1cm4gTWV0YURhdGFTZXJ2aWNlLmdldEFiaWxpdGllcyh0aGlzLmNoYXJhY3Rlci5jbGFzcywgdGhpcy5jaGFyYWN0ZXIubGV2ZWwpO1xyXG4gICAgfVxyXG59Il19