"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var file_system_1 = require("file-system");
var DataService = (function () {
    function DataService() {
        var _this = this;
        this.wasLoaded = false;
        this.folderName = "characters-data";
        this.fileName = "characters.json";
        this.loadedFunctions = [];
        this.subCode = 0;
        this.addLoadedEvent = function (callback) {
            _this.loadedFunctions[_this.subCode] = callback;
            ++_this.subCode;
            return _this.subCode;
        };
        this.removeLoadedEvent = function (subCode) {
            delete _this.loadedFunctions[subCode];
        };
        this.loadData = function () {
            var folder = file_system_1.knownFolders.documents().getFolder(_this.folderName);
            var file = folder.getFile(_this.fileName);
            file.readText()
                .then(function (data) {
                if (data != null && data != "")
                    _this.characters = JSON.parse(data);
                else
                    _this.characters = new Array();
                _this.wasLoaded = true;
                _this.loadedFunctions.forEach(function (callback) { return callback(); });
            })
                .catch(function (err) { return console.log(err); });
        };
        this.saveData = function () {
            var folder = file_system_1.knownFolders.documents().getFolder(_this.folderName);
            var file = folder.getFile(_this.fileName);
            file.writeText(JSON.stringify(_this.characters));
        };
        this.setSelectedCharacter = function (id) {
            _this.selectedId = id;
        };
        this.getSelectedCharacter = function () {
            var character = _this.characters.filter((function (character) { return character.id == _this.selectedId; }), _this.selectedId)[0];
            _this.validateCharacter(character);
            return character;
        };
        this.findNextId = function () {
            var tmp = _this.characters.sort(function (a, b) { return a.id - b.id; });
            if (tmp == null || tmp.length == 0)
                return 1;
            return tmp[tmp.length - 1].id + 1;
        };
        this.getCharacters = function () {
            if (_this.wasLoaded == false)
                _this.loadData();
            return _this.characters;
        };
        this.getCharacter = function (id) {
            var character = _this.characters.find(function (character) { return character.id == id; });
            _this.validateCharacter(character);
            return character;
        };
        this.validateCharacter = function (character) {
            if (character != null) {
                if (character.treasure == null)
                    character.treasure = new Treasure();
                if (character.spellbook == null)
                    character.spellbook = new Spellbook();
                if (character.spellslots == null)
                    character.spellslots = new Spellslots();
            }
        };
        this.addCharacter = function () {
            _this.characters[_this.characters.length] = new Character(_this.findNextId());
            _this.saveData();
        };
        this.deleteCharacter = function (id) {
            var index = _this.characters.findIndex(function (character) { return character.id == id; });
            _this.characters.splice(index, 1);
        };
    }
    return DataService;
}());
DataService = __decorate([
    core_1.Injectable()
], DataService);
exports.DataService = DataService;
var Character = (function () {
    function Character(id) {
        this.id = id;
        this.playerName = "New Player";
        this.characterName = "New Character";
        this.level = 1;
        this.xp = 0;
        this.strength = 3;
        this.dexterity = 3;
        this.constitution = 3;
        this.intelligence = 3;
        this.wisdom = 3;
        this.charisma = 3;
        this.ac = 9;
        this.weapons = new Array();
        this.treasure = new Treasure();
        this.spellbook = new Spellbook();
        this.spellslots = new Spellslots();
    }
    return Character;
}());
exports.Character = Character;
var Spellbook = (function () {
    function Spellbook() {
    }
    return Spellbook;
}());
exports.Spellbook = Spellbook;
var Spellslots = (function () {
    function Spellslots() {
    }
    return Spellslots;
}());
exports.Spellslots = Spellslots;
var Treasure = (function () {
    function Treasure() {
    }
    return Treasure;
}());
exports.Treasure = Treasure;
var Weapon = (function () {
    function Weapon() {
    }
    return Weapon;
}());
exports.Weapon = Weapon;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRhdGFzb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsMkNBQXlEO0FBSXpELElBQWEsV0FBVztJQUR4QjtRQUFBLGlCQTZGQztRQXpGVyxjQUFTLEdBQVksS0FBSyxDQUFDO1FBQzNCLGVBQVUsR0FBVyxpQkFBaUIsQ0FBQztRQUN2QyxhQUFRLEdBQVcsaUJBQWlCLENBQUM7UUFDckMsb0JBQWUsR0FBRyxFQUFFLENBQUM7UUFDckIsWUFBTyxHQUFHLENBQUMsQ0FBQztRQUVwQixtQkFBYyxHQUFHLFVBQUMsUUFBUTtZQUN0QixLQUFJLENBQUMsZUFBZSxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxRQUFRLENBQUM7WUFDOUMsRUFBRSxLQUFJLENBQUMsT0FBTyxDQUFDO1lBQ2YsTUFBTSxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUM7UUFDeEIsQ0FBQyxDQUFBO1FBRUQsc0JBQWlCLEdBQUcsVUFBQyxPQUFPO1lBQ3hCLE9BQU8sS0FBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUE7UUFFRCxhQUFRLEdBQUc7WUFDUCxJQUFJLE1BQU0sR0FBRywwQkFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDakUsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFekMsSUFBSSxDQUFDLFFBQVEsRUFBRTtpQkFDVixJQUFJLENBQUMsVUFBQSxJQUFJO2dCQUNOLEVBQUUsQ0FBQSxDQUFDLElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLEVBQUUsQ0FBQztvQkFDMUIsS0FBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN2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RUFBRSxHQUFHLENBQUMsQ0FBQztRQUNaLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ1osSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLEtBQUssRUFBVSxDQUFDO1FBQ25DLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksU0FBUyxFQUFFLENBQUM7UUFDakMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDO0lBQ3ZDLENBQUM7SUF3QkwsZ0JBQUM7QUFBRCxDQUFDLEFBMUNELElBMENDO0FBMUNZLDhCQUFTO0FBNEN0QjtJQUFBO0lBVUEsQ0FBQztJQUFELGdCQUFDO0FBQUQsQ0FBQyxBQVZELElBVUM7QUFWWSw4QkFBUztBQVl0QjtJQUFBO0lBVUEsQ0FBQztJQUFELGlCQUFDO0FBQUQsQ0FBQyxBQVZELElBVUM7QUFWWSxnQ0FBVTtBQVl2QjtJQUFBO0lBT0EsQ0FBQztJQUFELGVBQUM7QUFBRCxDQUFDLEFBUEQsSUFPQztBQVBZLDRCQUFRO0FBU3JCO0lBQUE7SUFLQSxDQUFDO0lBQUQsYUFBQztBQUFELENBQUMsQUFMRCxJQUtDO0FBTFksd0JBQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGtub3duRm9sZGVycywgRmlsZSwgRm9sZGVyIH0gZnJvbSBcImZpbGUtc3lzdGVtXCI7XHJcbmltcG9ydCB7IENsYXNzIH0gZnJvbSAnLi9tZXRhZGF0YXNvdXJjZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEYXRhU2VydmljZSB7XHJcbiAgICBwcml2YXRlIGNoYXJhY3RlcnM6IENoYXJhY3RlcltdO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RlZElkOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIHdhc0xvYWRlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBmb2xkZXJOYW1lOiBzdHJpbmcgPSBcImNoYXJhY3RlcnMtZGF0YVwiO1xyXG4gICAgcHJpdmF0ZSBmaWxlTmFtZTogc3RyaW5nID0gXCJjaGFyYWN0ZXJzLmpzb25cIjtcclxuICAgIHByaXZhdGUgbG9hZGVkRnVuY3Rpb25zID0gW107XHJcbiAgICBwcml2YXRlIHN1YkNvZGUgPSAwO1xyXG5cclxuICAgIGFkZExvYWRlZEV2ZW50ID0gKGNhbGxiYWNrKSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2FkZWRGdW5jdGlvbnNbdGhpcy5zdWJDb2RlXSA9IGNhbGxiYWNrO1xyXG4gICAgICAgICsrdGhpcy5zdWJDb2RlO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN1YkNvZGU7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlTG9hZGVkRXZlbnQgPSAoc3ViQ29kZSkgPT4ge1xyXG4gICAgICAgIGRlbGV0ZSB0aGlzLmxvYWRlZEZ1bmN0aW9uc1tzdWJDb2RlXTtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkRGF0YSA9ICgpID0+IHtcclxuICAgICAgICBsZXQgZm9sZGVyID0ga25vd25Gb2xkZXJzLmRvY3VtZW50cygpLmdldEZvbGRlcih0aGlzLmZvbGRlck5hbWUpO1xyXG4gICAgICAgIGxldCBmaWxlID0gZm9sZGVyLmdldEZpbGUodGhpcy5maWxlTmFtZSk7XHJcblxyXG4gICAgICAgIGZpbGUucmVhZFRleHQoKVxyXG4gICAgICAgICAgICAudGhlbihkYXRhID0+IHsgXHJcbiAgICAgICAgICAgICAgICBpZihkYXRhICE9IG51bGwgJiYgZGF0YSAhPSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhcmFjdGVycyA9IEpTT04ucGFyc2UoZGF0YSk7IFxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhcmFjdGVycyA9IG5ldyBBcnJheTxDaGFyYWN0ZXI+KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndhc0xvYWRlZCA9IHRydWU7IFxyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkZWRGdW5jdGlvbnMuZm9yRWFjaCgoY2FsbGJhY2spID0+IGNhbGxiYWNrKCkpfSlcclxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlRGF0YSA9ICgpID0+IHtcclxuICAgICAgICBsZXQgZm9sZGVyID0ga25vd25Gb2xkZXJzLmRvY3VtZW50cygpLmdldEZvbGRlcih0aGlzLmZvbGRlck5hbWUpO1xyXG4gICAgICAgIGxldCBmaWxlID0gZm9sZGVyLmdldEZpbGUodGhpcy5maWxlTmFtZSk7XHJcblxyXG4gICAgICAgIGZpbGUud3JpdGVUZXh0KEpTT04uc3RyaW5naWZ5KHRoaXMuY2hhcmFjdGVycykpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNlbGVjdGVkQ2hhcmFjdGVyID0gKGlkOiBudW1iZXIpID0+IHtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkSWQgPSBpZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWxlY3RlZENoYXJhY3RlciA9ICgpOiBDaGFyYWN0ZXIgPT4ge1xyXG4gICAgICAgIGxldCBjaGFyYWN0ZXI6IENoYXJhY3RlciA9IHRoaXMuY2hhcmFjdGVycy5maWx0ZXIoKChjaGFyYWN0ZXIpID0+IGNoYXJhY3Rlci5pZCA9PSB0aGlzLnNlbGVjdGVkSWQpLCB0aGlzLnNlbGVjdGVkSWQpWzBdO1xyXG5cclxuICAgICAgICB0aGlzLnZhbGlkYXRlQ2hhcmFjdGVyKGNoYXJhY3Rlcik7XHJcbiAgICAgICAgcmV0dXJuIGNoYXJhY3RlcjtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kTmV4dElkID0gKCk6IG51bWJlciA9PiB7XHJcbiAgICAgICAgbGV0IHRtcCA9IHRoaXMuY2hhcmFjdGVycy5zb3J0KChhLCBiKSA9PiBhLmlkIC0gYi5pZCk7XHJcbiAgICAgICAgaWYodG1wID09IG51bGwgfHwgdG1wLmxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICByZXR1cm4gdG1wW3RtcC5sZW5ndGggLSAxXS5pZCArIDE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2hhcmFjdGVycyA9ICgpOiBDaGFyYWN0ZXJbXSA9PiB7XHJcbiAgICAgICAgaWYodGhpcy53YXNMb2FkZWQgPT0gZmFsc2UpXHJcbiAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENoYXJhY3RlciA9IChpZDogbnVtYmVyKTogQ2hhcmFjdGVyID0+IHtcclxuICAgICAgICBsZXQgY2hhcmFjdGVyOiBDaGFyYWN0ZXIgPSB0aGlzLmNoYXJhY3RlcnMuZmluZCgoY2hhcmFjdGVyKSA9PiBjaGFyYWN0ZXIuaWQgPT0gaWQpO1xyXG5cclxuICAgICAgICB0aGlzLnZhbGlkYXRlQ2hhcmFjdGVyKGNoYXJhY3Rlcik7XHJcbiAgICAgICAgcmV0dXJuIGNoYXJhY3RlcjtcclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZUNoYXJhY3RlciA9IChjaGFyYWN0ZXI6IENoYXJhY3RlcikgPT4ge1xyXG4gICAgICAgIGlmKGNoYXJhY3RlciAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmKGNoYXJhY3Rlci50cmVhc3VyZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyLnRyZWFzdXJlID0gbmV3IFRyZWFzdXJlKCk7XHJcbiAgICAgICAgICAgIGlmKGNoYXJhY3Rlci5zcGVsbGJvb2sgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIGNoYXJhY3Rlci5zcGVsbGJvb2sgPSBuZXcgU3BlbGxib29rKCk7XHJcbiAgICAgICAgICAgIGlmKGNoYXJhY3Rlci5zcGVsbHNsb3RzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuc3BlbGxzbG90cyA9IG5ldyBTcGVsbHNsb3RzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFkZENoYXJhY3RlciA9ICgpOiB2b2lkID0+IHtcclxuICAgICAgICB0aGlzLmNoYXJhY3RlcnNbdGhpcy5jaGFyYWN0ZXJzLmxlbmd0aF0gPSBuZXcgQ2hhcmFjdGVyKHRoaXMuZmluZE5leHRJZCgpKTtcclxuICAgICAgICB0aGlzLnNhdmVEYXRhKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlQ2hhcmFjdGVyID0gKGlkKTogdm9pZCA9PiB7XHJcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5jaGFyYWN0ZXJzLmZpbmRJbmRleCgoY2hhcmFjdGVyKSA9PiBjaGFyYWN0ZXIuaWQgPT0gaWQpO1xyXG4gICAgICAgIHRoaXMuY2hhcmFjdGVycy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQ2hhcmFjdGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKGlkOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLmlkID0gaWQ7XHJcbiAgICAgICAgdGhpcy5wbGF5ZXJOYW1lID0gXCJOZXcgUGxheWVyXCI7XHJcbiAgICAgICAgdGhpcy5jaGFyYWN0ZXJOYW1lID0gXCJOZXcgQ2hhcmFjdGVyXCI7XHJcbiAgICAgICAgdGhpcy5sZXZlbCA9IDE7XHJcbiAgICAgICAgdGhpcy54cCA9IDA7XHJcbiAgICAgICAgdGhpcy5zdHJlbmd0aCA9IDM7XHJcbiAgICAgICAgdGhpcy5kZXh0ZXJpdHkgPSAzO1xyXG4gICAgICAgIHRoaXMuY29uc3RpdHV0aW9uID0gMztcclxuICAgICAgICB0aGlzLmludGVsbGlnZW5jZSA9IDM7XHJcbiAgICAgICAgdGhpcy53aXNkb20gPSAzO1xyXG4gICAgICAgIHRoaXMuY2hhcmlzbWEgPSAzO1xyXG4gICAgICAgIHRoaXMuYWMgPSA5O1xyXG4gICAgICAgIHRoaXMud2VhcG9ucyA9IG5ldyBBcnJheTxXZWFwb24+KCk7XHJcbiAgICAgICAgdGhpcy50cmVhc3VyZSA9IG5ldyBUcmVhc3VyZSgpO1xyXG4gICAgICAgIHRoaXMuc3BlbGxib29rID0gbmV3IFNwZWxsYm9vaygpO1xyXG4gICAgICAgIHRoaXMuc3BlbGxzbG90cyA9IG5ldyBTcGVsbHNsb3RzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWQ6IG51bWJlcjtcclxuICAgIHBsYXllck5hbWU6IHN0cmluZztcclxuICAgIGNoYXJhY3Rlck5hbWU6IHN0cmluZztcclxuICAgIGFsaWdubWVudDogc3RyaW5nO1xyXG4gICAgY2xhc3M6IENsYXNzO1xyXG4gICAgbGV2ZWw6IG51bWJlcjtcclxuICAgIHhwOiBudW1iZXI7XHJcbiAgICBzdHJlbmd0aDogbnVtYmVyO1xyXG4gICAgZGV4dGVyaXR5OiBudW1iZXI7XHJcbiAgICBjb25zdGl0dXRpb246IG51bWJlcjtcclxuICAgIGludGVsbGlnZW5jZTogbnVtYmVyO1xyXG4gICAgd2lzZG9tOiBudW1iZXI7XHJcbiAgICBjaGFyaXNtYTogbnVtYmVyO1xyXG4gICAgYWM6IG51bWJlcjtcclxuICAgIHdlYXBvbnM6IFdlYXBvbltdO1xyXG4gICAgbWFnaWNFcXVpcG1lbnQ6IHN0cmluZztcclxuICAgIHJlZ3VsYXJFcXVpcG1lbnQ6IHN0cmluZztcclxuICAgIGpvdXJuYWw6IHN0cmluZztcclxuICAgIG5vdGVzOiBzdHJpbmc7XHJcbiAgICBzcGVsbGJvb2s6IFNwZWxsYm9vaztcclxuICAgIHNwZWxsc2xvdHM6IFNwZWxsc2xvdHM7XHJcbiAgICB0cmVhc3VyZTogVHJlYXN1cmU7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBTcGVsbGJvb2sge1xyXG4gICAgc3BlbGxzMTogc3RyaW5nO1xyXG4gICAgc3BlbGxzMjogc3RyaW5nO1xyXG4gICAgc3BlbGxzMzogc3RyaW5nO1xyXG4gICAgc3BlbGxzNDogc3RyaW5nO1xyXG4gICAgc3BlbGxzNTogc3RyaW5nO1xyXG4gICAgc3BlbGxzNjogc3RyaW5nO1xyXG4gICAgc3BlbGxzNzogc3RyaW5nO1xyXG4gICAgc3BlbGxzODogc3RyaW5nO1xyXG4gICAgc3BlbGxzOTogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU3BlbGxzbG90cyB7XHJcbiAgICBzcGVsbHMxOiBzdHJpbmc7XHJcbiAgICBzcGVsbHMyOiBzdHJpbmc7XHJcbiAgICBzcGVsbHMzOiBzdHJpbmc7XHJcbiAgICBzcGVsbHM0OiBzdHJpbmc7XHJcbiAgICBzcGVsbHM1OiBzdHJpbmc7XHJcbiAgICBzcGVsbHM2OiBzdHJpbmc7XHJcbiAgICBzcGVsbHM3OiBzdHJpbmc7XHJcbiAgICBzcGVsbHM4OiBzdHJpbmc7XHJcbiAgICBzcGVsbHM5OiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBUcmVhc3VyZSB7XHJcbiAgICBwcDogbnVtYmVyO1xyXG4gICAgZ3A6IG51bWJlcjtcclxuICAgIGVwOiBudW1iZXI7XHJcbiAgICBzcDogbnVtYmVyO1xyXG4gICAgY3A6IG51bWJlcjtcclxuICAgIGl0ZW1zOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBXZWFwb24ge1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgcmFuZ2U6IHN0cmluZztcclxuICAgIGRhbWFnZTogc3RyaW5nO1xyXG4gICAgYXR0YWNrOiBzdHJpbmc7XHJcbn0iXX0=