"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var datasource_1 = require("../data/datasource");
var characterlogic_1 = require("../data/characterlogic");
var toolbar_component_1 = require("./toolbar.component");
var dialogs_1 = require("ui/dialogs");
var CombatComponent = (function () {
    function CombatComponent(dataService) {
        var _this = this;
        this.dataService = dataService;
        this.currentTab = toolbar_component_1.CharacterTab.Combat;
        this.onAcChange = function (arg) {
            _this.reverseAc = _this.logic.getReverseAC();
        };
        this.addWeapon = function () {
            if (_this.weaponName == null || _this.weaponName == "") {
                dialogs_1.alert("Cannot insert a weapon without a name");
                return;
            }
            if (_this.weaponAttack == null || _this.weaponAttack == "") {
                dialogs_1.alert("Cannot insert a weapon without attack butons");
                return;
            }
            if (_this.weaponDamage == null || _this.weaponDamage == "") {
                dialogs_1.alert("Cannot insert a weapon without damage");
                return;
            }
            var weapon = new datasource_1.Weapon();
            weapon.name = _this.weaponName;
            weapon.attack = _this.weaponAttack;
            weapon.damage = _this.weaponDamage;
            weapon.range = _this.weaponRange;
            if (_this.character.weapons == null)
                _this.character.weapons = new Array();
            _this.character.weapons.push(weapon);
        };
        this.deleteWeapon = function (index) {
            var name = _this.character.weapons[index].name;
            dialogs_1.confirm("Are you sure you want to delete " + name + ". Once deleted " + name + " will be lost. Continue?")
                .then(function (result) {
                if (result == true)
                    _this.character.weapons.splice(index, 1);
            });
        };
    }
    CombatComponent.prototype.ngOnInit = function () {
        this.character = this.dataService.getSelectedCharacter();
        this.logic = new characterlogic_1.CharacterLogic(this.character);
        this.reverseAc = this.logic.getReverseAC();
    };
    return CombatComponent;
}());
CombatComponent = __decorate([
    core_1.Component({
        selector: "combat",
        template: "<GridLayout rows=\"auto, auto, auto, *\">\n                <Toolbar [currentLocation]=\"currentTab\" row=\"0\"></Toolbar>\n                <StackLayout class=\"form\" row=\"1\">\n                    <GridLayout columns=\"auto, *, auto\" rows=\"auto, auto\" class=\"input-field input-sides\">\n                        <Label text=\"THAC0\" row=\"0\" col=\"0\" class=\"body p-r-5\"></Label>\n                        <Label [text]=\"this.logic.getTHAC0()\" row=\"0\" col=\"1\" class=\"body\"></Label>\n                        <Label [text]=\"'(' + this.logic.getAttackBonus() + ')'\" row=\"0\" col=\"2\" class=\"body\"></Label>\n                        <Label text=\"AC\" row=\"1\" col=\"0\" class=\"body\"></Label>\n                        <TextField [(ngModel)]=\"character.ac\" row=\"1\" col=\"1\" keyboardType=\"number\" (ngModelChange)=\"onAcChange($event)\" class=\"input botton_border\"></TextField>\n                        <Label [text]=\"'(' + reverseAc + ')'\" row=\"1\" col=\"2\" class=\"body\"></Label>\n                    </GridLayout>\n                </StackLayout>\n                <StackLayout class=\"form\" row=\"2\">\n                    <GridLayout rows=\"auto, auto\" columns=\"*, *, *, *, *\" class=\"input-field input-sides\">\n                        <Label text=\"Weapon\" row=\"0\" col=\"0\" class=\"body\"></Label>\n                        <Label text=\"Attack\" row=\"0\" col=\"1\" class=\"body\"></Label>\n                        <Label text=\"Damage\" row=\"0\" col=\"2\" class=\"body\"></Label>\n                        <Label text=\"Range\" row=\"0\" col=\"3\" class=\"body\"></Label>\n                        <TextField [(ngModel)]=\"weaponName\" row=\"1\" col=\"0\" class=\"input botton_border\" style=\"margin-right:10px;\"></TextField>\n                        <TextField [(ngModel)]=\"weaponAttack\" row=\"1\" col=\"1\" class=\"input botton_border\" style=\"margin-right:10px;\"></TextField>\n                        <TextField [(ngModel)]=\"weaponDamage\" row=\"1\" col=\"2\" class=\"input botton_border\" style=\"margin-right:10px;\"></TextField>\n                        <TextField [(ngModel)]=\"weaponRange\" row=\"1\" col=\"3\" class=\"input botton_border\"></TextField>\n                        <Button text=\"Add\" (tap)=\"addWeapon()\" row=\"1\" col=\"4\" class=\"btn-primary btn-form\"></Button>\n                    </GridLayout>\n                </StackLayout>\n                <StackLayout row=\"3\" class=\"form\">\n                    <ListView [items]=\"character.weapons\" class=\"input-field input-sides\">\n                        <ng-template let-item=\"item\" let-i=\"index\">\n                            <GridLayout columns=\"*, *, *, *, *\">\n                                <Label [text]=\"[item.name]\" col=\"0\" class=\"body\"></Label>\n                                <Label [text]=\"[item.attack]\" col=\"1\" class=\"body\"></Label>\n                                <Label [text]=\"[item.damage]\" col=\"2\" class=\"body\"></Label>\n                                <Label [text]=\"item.range\" col=\"3\" class=\"body\"></Label>\n                                <Button text=\"Delete\" (tap)=\"deleteWeapon(i)\" col=\"4\" class=\"btn-primary btn-form\" textWrap=\"true\"></Button>\n                            </GridLayout>\n                        </ng-template>\n                    </ListView>\n                </StackLayout>\n                </GridLayout>"
    }),
    __metadata("design:paramtypes", [datasource_1.DataService])
], CombatComponent);
exports.CombatComponent = CombatComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYmF0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvbWJhdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBNEQ7QUFDNUQsaURBQW9FO0FBQ3BFLHlEQUF3RDtBQUN4RCx5REFBcUU7QUFDckUsc0NBQTRDO0FBNkM1QyxJQUFhLGVBQWU7SUFDeEIseUJBQTJCLFdBQXdCO1FBQW5ELGlCQUF3RDtRQUE3QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQVEzQyxlQUFVLEdBQWlCLGdDQUFZLENBQUMsTUFBTSxDQUFDO1FBUXZELGVBQVUsR0FBRyxVQUFDLEdBQUc7WUFDYixLQUFJLENBQUMsU0FBUyxHQUFHLEtBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDL0MsQ0FBQyxDQUFBO1FBRUQsY0FBUyxHQUFHO1lBQ1IsRUFBRSxDQUFBLENBQUMsS0FBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLElBQUksS0FBSSxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNsRCxlQUFLLENBQUMsdUNBQXVDLENBQUMsQ0FBQztnQkFDL0MsTUFBTSxDQUFDO1lBQ1gsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLEtBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxJQUFJLEtBQUksQ0FBQyxZQUFZLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDdEQsZUFBSyxDQUFDLDhDQUE4QyxDQUFDLENBQUM7Z0JBQ3RELE1BQU0sQ0FBQztZQUNYLENBQUM7WUFDRCxFQUFFLENBQUEsQ0FBQyxLQUFJLENBQUMsWUFBWSxJQUFJLElBQUksSUFBSSxLQUFJLENBQUMsWUFBWSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RELGVBQUssQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO2dCQUMvQyxNQUFNLENBQUM7WUFDWCxDQUFDO1lBQ0QsSUFBSSxNQUFNLEdBQUcsSUFBSSxtQkFBTSxFQUFFLENBQUM7WUFDMUIsTUFBTSxDQUFDLElBQUksR0FBRyxLQUFJLENBQUMsVUFBVSxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxNQUFNLEdBQUcsS0FBSSxDQUFDLFlBQVksQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxHQUFHLEtBQUksQ0FBQyxZQUFZLENBQUM7WUFDbEMsTUFBTSxDQUFDLEtBQUssR0FBRyxLQUFJLENBQUMsV0FBVyxDQUFDO1lBQ2hDLEVBQUUsQ0FBQSxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQztnQkFDOUIsS0FBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQVUsQ0FBQztZQUNqRCxLQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFBO1FBRUQsaUJBQVksR0FBRyxVQUFDLEtBQUs7WUFDakIsSUFBSSxJQUFJLEdBQUcsS0FBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQzlDLGlCQUFPLENBQUMsa0NBQWtDLEdBQUcsSUFBSSxHQUFJLGlCQUFpQixHQUFHLElBQUksR0FBRywwQkFBMEIsQ0FBQztpQkFDbEcsSUFBSSxDQUFDLFVBQUEsTUFBTTtnQkFDUixFQUFFLENBQUEsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDO29CQUNkLEtBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDaEQsQ0FBQyxDQUFDLENBQUM7UUFDZixDQUFDLENBQUE7SUFsRHNELENBQUM7SUFVeEQsa0NBQVEsR0FBUjtRQUNJLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQ3pELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSwrQkFBYyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNoRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDL0MsQ0FBQztJQXFDTCxzQkFBQztBQUFELENBQUMsQUFwREQsSUFvREM7QUFwRFksZUFBZTtJQTNDM0IsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLFFBQVEsRUFBRSxpMkdBc0NnQjtLQUM3QixDQUFDO3FDQUcwQyx3QkFBVztHQUQxQyxlQUFlLENBb0QzQjtBQXBEWSwwQ0FBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBOZ01vZHVsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IENoYXJhY3RlciwgRGF0YVNlcnZpY2UsIFdlYXBvbiB9IGZyb20gJy4uL2RhdGEvZGF0YXNvdXJjZSc7XHJcbmltcG9ydCB7IENoYXJhY3RlckxvZ2ljIH0gZnJvbSAnLi4vZGF0YS9jaGFyYWN0ZXJsb2dpYyc7XHJcbmltcG9ydCB7IFRvb2xiYXJDb21wb25lbnQsIENoYXJhY3RlclRhYiB9IGZyb20gJy4vdG9vbGJhci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBhbGVydCwgY29uZmlybSB9IGZyb20gXCJ1aS9kaWFsb2dzXCI7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiBcImNvbWJhdFwiLFxyXG4gICAgdGVtcGxhdGU6IGA8R3JpZExheW91dCByb3dzPVwiYXV0bywgYXV0bywgYXV0bywgKlwiPlxyXG4gICAgICAgICAgICAgICAgPFRvb2xiYXIgW2N1cnJlbnRMb2NhdGlvbl09XCJjdXJyZW50VGFiXCIgcm93PVwiMFwiPjwvVG9vbGJhcj5cclxuICAgICAgICAgICAgICAgIDxTdGFja0xheW91dCBjbGFzcz1cImZvcm1cIiByb3c9XCIxXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPEdyaWRMYXlvdXQgY29sdW1ucz1cImF1dG8sICosIGF1dG9cIiByb3dzPVwiYXV0bywgYXV0b1wiIGNsYXNzPVwiaW5wdXQtZmllbGQgaW5wdXQtc2lkZXNcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPExhYmVsIHRleHQ9XCJUSEFDMFwiIHJvdz1cIjBcIiBjb2w9XCIwXCIgY2xhc3M9XCJib2R5IHAtci01XCI+PC9MYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPExhYmVsIFt0ZXh0XT1cInRoaXMubG9naWMuZ2V0VEhBQzAoKVwiIHJvdz1cIjBcIiBjb2w9XCIxXCIgY2xhc3M9XCJib2R5XCI+PC9MYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPExhYmVsIFt0ZXh0XT1cIicoJyArIHRoaXMubG9naWMuZ2V0QXR0YWNrQm9udXMoKSArICcpJ1wiIHJvdz1cIjBcIiBjb2w9XCIyXCIgY2xhc3M9XCJib2R5XCI+PC9MYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPExhYmVsIHRleHQ9XCJBQ1wiIHJvdz1cIjFcIiBjb2w9XCIwXCIgY2xhc3M9XCJib2R5XCI+PC9MYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPFRleHRGaWVsZCBbKG5nTW9kZWwpXT1cImNoYXJhY3Rlci5hY1wiIHJvdz1cIjFcIiBjb2w9XCIxXCIga2V5Ym9hcmRUeXBlPVwibnVtYmVyXCIgKG5nTW9kZWxDaGFuZ2UpPVwib25BY0NoYW5nZSgkZXZlbnQpXCIgY2xhc3M9XCJpbnB1dCBib3R0b25fYm9yZGVyXCI+PC9UZXh0RmllbGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxMYWJlbCBbdGV4dF09XCInKCcgKyByZXZlcnNlQWMgKyAnKSdcIiByb3c9XCIxXCIgY29sPVwiMlwiIGNsYXNzPVwiYm9keVwiPjwvTGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9HcmlkTGF5b3V0PlxyXG4gICAgICAgICAgICAgICAgPC9TdGFja0xheW91dD5cclxuICAgICAgICAgICAgICAgIDxTdGFja0xheW91dCBjbGFzcz1cImZvcm1cIiByb3c9XCIyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPEdyaWRMYXlvdXQgcm93cz1cImF1dG8sIGF1dG9cIiBjb2x1bW5zPVwiKiwgKiwgKiwgKiwgKlwiIGNsYXNzPVwiaW5wdXQtZmllbGQgaW5wdXQtc2lkZXNcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPExhYmVsIHRleHQ9XCJXZWFwb25cIiByb3c9XCIwXCIgY29sPVwiMFwiIGNsYXNzPVwiYm9keVwiPjwvTGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxMYWJlbCB0ZXh0PVwiQXR0YWNrXCIgcm93PVwiMFwiIGNvbD1cIjFcIiBjbGFzcz1cImJvZHlcIj48L0xhYmVsPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgdGV4dD1cIkRhbWFnZVwiIHJvdz1cIjBcIiBjb2w9XCIyXCIgY2xhc3M9XCJib2R5XCI+PC9MYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPExhYmVsIHRleHQ9XCJSYW5nZVwiIHJvdz1cIjBcIiBjb2w9XCIzXCIgY2xhc3M9XCJib2R5XCI+PC9MYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPFRleHRGaWVsZCBbKG5nTW9kZWwpXT1cIndlYXBvbk5hbWVcIiByb3c9XCIxXCIgY29sPVwiMFwiIGNsYXNzPVwiaW5wdXQgYm90dG9uX2JvcmRlclwiIHN0eWxlPVwibWFyZ2luLXJpZ2h0OjEwcHg7XCI+PC9UZXh0RmllbGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0RmllbGQgWyhuZ01vZGVsKV09XCJ3ZWFwb25BdHRhY2tcIiByb3c9XCIxXCIgY29sPVwiMVwiIGNsYXNzPVwiaW5wdXQgYm90dG9uX2JvcmRlclwiIHN0eWxlPVwibWFyZ2luLXJpZ2h0OjEwcHg7XCI+PC9UZXh0RmllbGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0RmllbGQgWyhuZ01vZGVsKV09XCJ3ZWFwb25EYW1hZ2VcIiByb3c9XCIxXCIgY29sPVwiMlwiIGNsYXNzPVwiaW5wdXQgYm90dG9uX2JvcmRlclwiIHN0eWxlPVwibWFyZ2luLXJpZ2h0OjEwcHg7XCI+PC9UZXh0RmllbGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0RmllbGQgWyhuZ01vZGVsKV09XCJ3ZWFwb25SYW5nZVwiIHJvdz1cIjFcIiBjb2w9XCIzXCIgY2xhc3M9XCJpbnB1dCBib3R0b25fYm9yZGVyXCI+PC9UZXh0RmllbGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdGV4dD1cIkFkZFwiICh0YXApPVwiYWRkV2VhcG9uKClcIiByb3c9XCIxXCIgY29sPVwiNFwiIGNsYXNzPVwiYnRuLXByaW1hcnkgYnRuLWZvcm1cIj48L0J1dHRvbj5cclxuICAgICAgICAgICAgICAgICAgICA8L0dyaWRMYXlvdXQ+XHJcbiAgICAgICAgICAgICAgICA8L1N0YWNrTGF5b3V0PlxyXG4gICAgICAgICAgICAgICAgPFN0YWNrTGF5b3V0IHJvdz1cIjNcIiBjbGFzcz1cImZvcm1cIj5cclxuICAgICAgICAgICAgICAgICAgICA8TGlzdFZpZXcgW2l0ZW1zXT1cImNoYXJhY3Rlci53ZWFwb25zXCIgY2xhc3M9XCJpbnB1dC1maWVsZCBpbnB1dC1zaWRlc1wiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGUgbGV0LWl0ZW09XCJpdGVtXCIgbGV0LWk9XCJpbmRleFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEdyaWRMYXlvdXQgY29sdW1ucz1cIiosICosICosICosICpcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgW3RleHRdPVwiW2l0ZW0ubmFtZV1cIiBjb2w9XCIwXCIgY2xhc3M9XCJib2R5XCI+PC9MYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgW3RleHRdPVwiW2l0ZW0uYXR0YWNrXVwiIGNvbD1cIjFcIiBjbGFzcz1cImJvZHlcIj48L0xhYmVsPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxMYWJlbCBbdGV4dF09XCJbaXRlbS5kYW1hZ2VdXCIgY29sPVwiMlwiIGNsYXNzPVwiYm9keVwiPjwvTGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPExhYmVsIFt0ZXh0XT1cIml0ZW0ucmFuZ2VcIiBjb2w9XCIzXCIgY2xhc3M9XCJib2R5XCI+PC9MYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIHRleHQ9XCJEZWxldGVcIiAodGFwKT1cImRlbGV0ZVdlYXBvbihpKVwiIGNvbD1cIjRcIiBjbGFzcz1cImJ0bi1wcmltYXJ5IGJ0bi1mb3JtXCIgdGV4dFdyYXA9XCJ0cnVlXCI+PC9CdXR0b24+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0dyaWRMYXlvdXQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9MaXN0Vmlldz5cclxuICAgICAgICAgICAgICAgIDwvU3RhY2tMYXlvdXQ+XHJcbiAgICAgICAgICAgICAgICA8L0dyaWRMYXlvdXQ+YFxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIENvbWJhdENvbXBvbmVudCB7XHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSBkYXRhU2VydmljZTogRGF0YVNlcnZpY2UpIHsgfVxyXG4gICAgcHJpdmF0ZSBjaGFyYWN0ZXI6IENoYXJhY3RlcjtcclxuICAgIHByaXZhdGUgbG9naWM6IENoYXJhY3RlckxvZ2ljO1xyXG4gICAgcHJpdmF0ZSByZXZlcnNlQWM6IG51bWJlcjtcclxuICAgIHByaXZhdGUgd2VhcG9uTmFtZTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSB3ZWFwb25BdHRhY2s6IHN0cmluZztcclxuICAgIHByaXZhdGUgd2VhcG9uRGFtYWdlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIHdlYXBvblJhbmdlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGN1cnJlbnRUYWI6IENoYXJhY3RlclRhYiA9IENoYXJhY3RlclRhYi5Db21iYXQ7XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jaGFyYWN0ZXIgPSB0aGlzLmRhdGFTZXJ2aWNlLmdldFNlbGVjdGVkQ2hhcmFjdGVyKCk7XHJcbiAgICAgICAgdGhpcy5sb2dpYyA9IG5ldyBDaGFyYWN0ZXJMb2dpYyh0aGlzLmNoYXJhY3Rlcik7XHJcbiAgICAgICAgdGhpcy5yZXZlcnNlQWMgPSB0aGlzLmxvZ2ljLmdldFJldmVyc2VBQygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQWNDaGFuZ2UgPSAoYXJnKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXZlcnNlQWMgPSB0aGlzLmxvZ2ljLmdldFJldmVyc2VBQygpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFdlYXBvbiA9ICgpID0+IHtcclxuICAgICAgICBpZih0aGlzLndlYXBvbk5hbWUgPT0gbnVsbCB8fCB0aGlzLndlYXBvbk5hbWUgPT0gXCJcIikge1xyXG4gICAgICAgICAgICBhbGVydChcIkNhbm5vdCBpbnNlcnQgYSB3ZWFwb24gd2l0aG91dCBhIG5hbWVcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy53ZWFwb25BdHRhY2sgPT0gbnVsbCB8fCB0aGlzLndlYXBvbkF0dGFjayA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGFsZXJ0KFwiQ2Fubm90IGluc2VydCBhIHdlYXBvbiB3aXRob3V0IGF0dGFjayBidXRvbnNcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy53ZWFwb25EYW1hZ2UgPT0gbnVsbCB8fCB0aGlzLndlYXBvbkRhbWFnZSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGFsZXJ0KFwiQ2Fubm90IGluc2VydCBhIHdlYXBvbiB3aXRob3V0IGRhbWFnZVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgd2VhcG9uID0gbmV3IFdlYXBvbigpO1xyXG4gICAgICAgIHdlYXBvbi5uYW1lID0gdGhpcy53ZWFwb25OYW1lO1xyXG4gICAgICAgIHdlYXBvbi5hdHRhY2sgPSB0aGlzLndlYXBvbkF0dGFjaztcclxuICAgICAgICB3ZWFwb24uZGFtYWdlID0gdGhpcy53ZWFwb25EYW1hZ2U7XHJcbiAgICAgICAgd2VhcG9uLnJhbmdlID0gdGhpcy53ZWFwb25SYW5nZTtcclxuICAgICAgICBpZih0aGlzLmNoYXJhY3Rlci53ZWFwb25zID09IG51bGwpXHJcbiAgICAgICAgICAgIHRoaXMuY2hhcmFjdGVyLndlYXBvbnMgPSBuZXcgQXJyYXk8V2VhcG9uPigpO1xyXG4gICAgICAgIHRoaXMuY2hhcmFjdGVyLndlYXBvbnMucHVzaCh3ZWFwb24pO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZVdlYXBvbiA9IChpbmRleCkgPT4ge1xyXG4gICAgICAgIGxldCBuYW1lID0gdGhpcy5jaGFyYWN0ZXIud2VhcG9uc1tpbmRleF0ubmFtZTtcclxuICAgICAgICBjb25maXJtKFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSBcIiArIG5hbWUgICsgXCIuIE9uY2UgZGVsZXRlZCBcIiArIG5hbWUgKyBcIiB3aWxsIGJlIGxvc3QuIENvbnRpbnVlP1wiKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgPT0gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFyYWN0ZXIud2VhcG9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXX0=