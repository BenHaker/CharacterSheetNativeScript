"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var file_system_1 = require("file-system");
var metadatasource_1 = require("./metadatasource");
var DataService = (function () {
    function DataService() {
        var _this = this;
        this.wasLoaded = false;
        this.folderName = "characters-data";
        this.fileName = "characters.json";
        this.loadedFunctions = [];
        this.subCode = 0;
        this.addLoadedEvent = function (callback) {
            _this.loadedFunctions[_this.subCode] = callback;
            ++_this.subCode;
            return _this.subCode;
        };
        this.removeLoadedEvent = function (subCode) {
            delete _this.loadedFunctions[subCode];
        };
        this.loadData = function () {
            var folder = file_system_1.knownFolders.documents().getFolder(_this.folderName);
            var file = folder.getFile(_this.fileName);
            file.readText()
                .then(function (data) {
                if (data != null && data != "")
                    _this.characters = JSON.parse(data);
                else
                    _this.characters = new Array();
                _this.wasLoaded = true;
                _this.loadedFunctions.forEach(function (callback) { return callback(); });
            })
                .catch(function (err) { return console.log(err); });
        };
        this.saveData = function () {
            var folder = file_system_1.knownFolders.documents().getFolder(_this.folderName);
            var file = folder.getFile(_this.fileName);
            file.writeText(JSON.stringify(_this.characters));
        };
        this.setSelectedCharacter = function (id) {
            _this.selectedId = id;
        };
        this.getSelectedCharacter = function () {
            var character = _this.characters.filter((function (character) { return character.id == _this.selectedId; }), _this.selectedId)[0];
            _this.validateCharacter(character);
            return character;
        };
        this.findNextId = function () {
            var tmp = _this.characters.sort(function (a, b) { return a.id - b.id; });
            if (tmp == null || tmp.length == 0)
                return 1;
            return tmp[tmp.length - 1].id + 1;
        };
        this.getCharacters = function () {
            if (_this.wasLoaded == false)
                _this.loadData();
            return _this.characters;
        };
        this.getCharacter = function (id) {
            var character = _this.characters.find(function (character) { return character.id == id; });
            _this.validateCharacter(character);
            return character;
        };
        this.validateCharacter = function (character) {
            if (character != null) {
                if (character.treasure == null)
                    character.treasure = new Treasure();
                if (character.spellbook == null)
                    character.spellbook = new Spellbook();
                if (character.spellslots == null)
                    character.spellslots = new Spellslots();
            }
        };
        this.addCharacter = function () {
            _this.characters[_this.characters.length] = new Character(_this.findNextId());
            _this.saveData();
        };
        this.deleteCharacter = function (id) {
            var index = _this.characters.findIndex(function (character) { return character.id == id; });
            _this.characters.splice(index, 1);
            _this.saveData();
        };
    }
    return DataService;
}());
DataService = __decorate([
    core_1.Injectable()
], DataService);
exports.DataService = DataService;
var Character = (function () {
    function Character(id) {
        this.id = id;
        this.playerName = "New Player";
        this.characterName = "New Character";
        this.class = metadatasource_1.Class.Cleric;
        this.level = 1;
        this.xp = 0;
        this.strength = 3;
        this.dexterity = 3;
        this.constitution = 3;
        this.intelligence = 3;
        this.wisdom = 3;
        this.charisma = 3;
        this.ac = 9;
        this.weapons = new Array();
        this.treasure = new Treasure();
        this.spellbook = new Spellbook();
        this.spellslots = new Spellslots();
    }
    return Character;
}());
exports.Character = Character;
var Spellbook = (function () {
    function Spellbook() {
    }
    return Spellbook;
}());
exports.Spellbook = Spellbook;
var Spellslots = (function () {
    function Spellslots() {
    }
    return Spellslots;
}());
exports.Spellslots = Spellslots;
var Treasure = (function () {
    function Treasure() {
    }
    return Treasure;
}());
exports.Treasure = Treasure;
var Weapon = (function () {
    function Weapon() {
    }
    return Weapon;
}());
exports.Weapon = Weapon;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRhdGFzb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsMkNBQXlEO0FBQ3pELG1EQUF5QztBQUd6QyxJQUFhLFdBQVc7SUFEeEI7UUFBQSxpQkE4RkM7UUExRlcsY0FBUyxHQUFZLEtBQUssQ0FBQztRQUMzQixlQUFVLEdBQVcsaUJBQWlCLENBQUM7UUFDdkMsYUFBUSxHQUFXLGlCQUFpQixDQUFDO1FBQ3JDLG9CQUFlLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLFlBQU8sR0FBRyxDQUFDLENBQUM7UUFFcEIsbUJBQWMsR0FBRyxVQUFDLFFBQVE7WUFDdEIsS0FBSSxDQUFDLGVBQWUsQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsUUFBUSxDQUFDO1lBQzlDLEVBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQztZQUNmLE1BQU0sQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDO1FBQ3hCLENBQUMsQ0FBQTtRQUVELHNCQUFpQixHQUFHLFVBQUMsT0FBTztZQUN4QixPQUFPLEtBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFBO1FBRUQsYUFBUSxHQUFHO1lBQ1AsSUFBSSxNQUFNLEdBQUcsMEJBQVksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2pFLElBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRXpDLElBQUksQ0FBQyxRQUFRLEVBQUU7aUJBQ1YsSUFBSSxDQUFDLFVBQUEsSUFBSTtnQkFDTixFQUFFLENBQUEsQ0FBQyxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFLENBQUM7b0JBQzFCLEtBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENB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J0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBrbm93bkZvbGRlcnMsIEZpbGUsIEZvbGRlciB9IGZyb20gXCJmaWxlLXN5c3RlbVwiO1xyXG5pbXBvcnQgeyBDbGFzcyB9IGZyb20gJy4vbWV0YWRhdGFzb3VyY2UnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRGF0YVNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBjaGFyYWN0ZXJzOiBDaGFyYWN0ZXJbXTtcclxuICAgIHByaXZhdGUgc2VsZWN0ZWRJZDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSB3YXNMb2FkZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgZm9sZGVyTmFtZTogc3RyaW5nID0gXCJjaGFyYWN0ZXJzLWRhdGFcIjtcclxuICAgIHByaXZhdGUgZmlsZU5hbWU6IHN0cmluZyA9IFwiY2hhcmFjdGVycy5qc29uXCI7XHJcbiAgICBwcml2YXRlIGxvYWRlZEZ1bmN0aW9ucyA9IFtdO1xyXG4gICAgcHJpdmF0ZSBzdWJDb2RlID0gMDtcclxuXHJcbiAgICBhZGRMb2FkZWRFdmVudCA9IChjYWxsYmFjaykgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZGVkRnVuY3Rpb25zW3RoaXMuc3ViQ29kZV0gPSBjYWxsYmFjaztcclxuICAgICAgICArK3RoaXMuc3ViQ29kZTtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdWJDb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUxvYWRlZEV2ZW50ID0gKHN1YkNvZGUpID0+IHtcclxuICAgICAgICBkZWxldGUgdGhpcy5sb2FkZWRGdW5jdGlvbnNbc3ViQ29kZV07XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZERhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgbGV0IGZvbGRlciA9IGtub3duRm9sZGVycy5kb2N1bWVudHMoKS5nZXRGb2xkZXIodGhpcy5mb2xkZXJOYW1lKTtcclxuICAgICAgICBsZXQgZmlsZSA9IGZvbGRlci5nZXRGaWxlKHRoaXMuZmlsZU5hbWUpO1xyXG5cclxuICAgICAgICBmaWxlLnJlYWRUZXh0KClcclxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7IFxyXG4gICAgICAgICAgICAgICAgaWYoZGF0YSAhPSBudWxsICYmIGRhdGEgIT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJhY3RlcnMgPSBKU09OLnBhcnNlKGRhdGEpOyBcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJhY3RlcnMgPSBuZXcgQXJyYXk8Q2hhcmFjdGVyPigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy53YXNMb2FkZWQgPSB0cnVlOyBcclxuICAgICAgICAgICAgICAgIHRoaXMubG9hZGVkRnVuY3Rpb25zLmZvckVhY2goKGNhbGxiYWNrKSA9PiBjYWxsYmFjaygpKX0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZURhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgbGV0IGZvbGRlciA9IGtub3duRm9sZGVycy5kb2N1bWVudHMoKS5nZXRGb2xkZXIodGhpcy5mb2xkZXJOYW1lKTtcclxuICAgICAgICBsZXQgZmlsZSA9IGZvbGRlci5nZXRGaWxlKHRoaXMuZmlsZU5hbWUpO1xyXG5cclxuICAgICAgICBmaWxlLndyaXRlVGV4dChKU09OLnN0cmluZ2lmeSh0aGlzLmNoYXJhY3RlcnMpKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTZWxlY3RlZENoYXJhY3RlciA9IChpZDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZElkID0gaWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2VsZWN0ZWRDaGFyYWN0ZXIgPSAoKTogQ2hhcmFjdGVyID0+IHtcclxuICAgICAgICBsZXQgY2hhcmFjdGVyOiBDaGFyYWN0ZXIgPSB0aGlzLmNoYXJhY3RlcnMuZmlsdGVyKCgoY2hhcmFjdGVyKSA9PiBjaGFyYWN0ZXIuaWQgPT0gdGhpcy5zZWxlY3RlZElkKSwgdGhpcy5zZWxlY3RlZElkKVswXTtcclxuXHJcbiAgICAgICAgdGhpcy52YWxpZGF0ZUNoYXJhY3RlcihjaGFyYWN0ZXIpO1xyXG4gICAgICAgIHJldHVybiBjaGFyYWN0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZE5leHRJZCA9ICgpOiBudW1iZXIgPT4ge1xyXG4gICAgICAgIGxldCB0bXAgPSB0aGlzLmNoYXJhY3RlcnMuc29ydCgoYSwgYikgPT4gYS5pZCAtIGIuaWQpO1xyXG4gICAgICAgIGlmKHRtcCA9PSBudWxsIHx8IHRtcC5sZW5ndGggPT0gMClcclxuICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgcmV0dXJuIHRtcFt0bXAubGVuZ3RoIC0gMV0uaWQgKyAxO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENoYXJhY3RlcnMgPSAoKTogQ2hhcmFjdGVyW10gPT4ge1xyXG4gICAgICAgIGlmKHRoaXMud2FzTG9hZGVkID09IGZhbHNlKVxyXG4gICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hhcmFjdGVycztcclxuICAgIH1cclxuXHJcbiAgICBnZXRDaGFyYWN0ZXIgPSAoaWQ6IG51bWJlcik6IENoYXJhY3RlciA9PiB7XHJcbiAgICAgICAgbGV0IGNoYXJhY3RlcjogQ2hhcmFjdGVyID0gdGhpcy5jaGFyYWN0ZXJzLmZpbmQoKGNoYXJhY3RlcikgPT4gY2hhcmFjdGVyLmlkID09IGlkKTtcclxuXHJcbiAgICAgICAgdGhpcy52YWxpZGF0ZUNoYXJhY3RlcihjaGFyYWN0ZXIpO1xyXG4gICAgICAgIHJldHVybiBjaGFyYWN0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVDaGFyYWN0ZXIgPSAoY2hhcmFjdGVyOiBDaGFyYWN0ZXIpID0+IHtcclxuICAgICAgICBpZihjaGFyYWN0ZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZihjaGFyYWN0ZXIudHJlYXN1cmUgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIGNoYXJhY3Rlci50cmVhc3VyZSA9IG5ldyBUcmVhc3VyZSgpO1xyXG4gICAgICAgICAgICBpZihjaGFyYWN0ZXIuc3BlbGxib29rID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuc3BlbGxib29rID0gbmV3IFNwZWxsYm9vaygpO1xyXG4gICAgICAgICAgICBpZihjaGFyYWN0ZXIuc3BlbGxzbG90cyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyLnNwZWxsc2xvdHMgPSBuZXcgU3BlbGxzbG90cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhZGRDaGFyYWN0ZXIgPSAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgdGhpcy5jaGFyYWN0ZXJzW3RoaXMuY2hhcmFjdGVycy5sZW5ndGhdID0gbmV3IENoYXJhY3Rlcih0aGlzLmZpbmROZXh0SWQoKSk7XHJcbiAgICAgICAgdGhpcy5zYXZlRGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNoYXJhY3RlciA9IChpZCk6IHZvaWQgPT4ge1xyXG4gICAgICAgIGxldCBpbmRleCA9IHRoaXMuY2hhcmFjdGVycy5maW5kSW5kZXgoKGNoYXJhY3RlcikgPT4gY2hhcmFjdGVyLmlkID09IGlkKTtcclxuICAgICAgICB0aGlzLmNoYXJhY3RlcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB0aGlzLnNhdmVEYXRhKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDaGFyYWN0ZXIge1xyXG4gICAgY29uc3RydWN0b3IoaWQ6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuaWQgPSBpZDtcclxuICAgICAgICB0aGlzLnBsYXllck5hbWUgPSBcIk5ldyBQbGF5ZXJcIjtcclxuICAgICAgICB0aGlzLmNoYXJhY3Rlck5hbWUgPSBcIk5ldyBDaGFyYWN0ZXJcIjtcclxuICAgICAgICB0aGlzLmNsYXNzID0gQ2xhc3MuQ2xlcmljO1xyXG4gICAgICAgIHRoaXMubGV2ZWwgPSAxO1xyXG4gICAgICAgIHRoaXMueHAgPSAwO1xyXG4gICAgICAgIHRoaXMuc3RyZW5ndGggPSAzO1xyXG4gICAgICAgIHRoaXMuZGV4dGVyaXR5ID0gMztcclxuICAgICAgICB0aGlzLmNvbnN0aXR1dGlvbiA9IDM7XHJcbiAgICAgICAgdGhpcy5pbnRlbGxpZ2VuY2UgPSAzO1xyXG4gICAgICAgIHRoaXMud2lzZG9tID0gMztcclxuICAgICAgICB0aGlzLmNoYXJpc21hID0gMztcclxuICAgICAgICB0aGlzLmFjID0gOTtcclxuICAgICAgICB0aGlzLndlYXBvbnMgPSBuZXcgQXJyYXk8V2VhcG9uPigpO1xyXG4gICAgICAgIHRoaXMudHJlYXN1cmUgPSBuZXcgVHJlYXN1cmUoKTtcclxuICAgICAgICB0aGlzLnNwZWxsYm9vayA9IG5ldyBTcGVsbGJvb2soKTtcclxuICAgICAgICB0aGlzLnNwZWxsc2xvdHMgPSBuZXcgU3BlbGxzbG90cygpO1xyXG4gICAgfVxyXG5cclxuICAgIGlkOiBudW1iZXI7XHJcbiAgICBwbGF5ZXJOYW1lOiBzdHJpbmc7XHJcbiAgICBjaGFyYWN0ZXJOYW1lOiBzdHJpbmc7XHJcbiAgICBhbGlnbm1lbnQ6IHN0cmluZztcclxuICAgIGNsYXNzOiBDbGFzcztcclxuICAgIGxldmVsOiBudW1iZXI7XHJcbiAgICB4cDogbnVtYmVyO1xyXG4gICAgc3RyZW5ndGg6IG51bWJlcjtcclxuICAgIGRleHRlcml0eTogbnVtYmVyO1xyXG4gICAgY29uc3RpdHV0aW9uOiBudW1iZXI7XHJcbiAgICBpbnRlbGxpZ2VuY2U6IG51bWJlcjtcclxuICAgIHdpc2RvbTogbnVtYmVyO1xyXG4gICAgY2hhcmlzbWE6IG51bWJlcjtcclxuICAgIGFjOiBudW1iZXI7XHJcbiAgICB3ZWFwb25zOiBXZWFwb25bXTtcclxuICAgIG1hZ2ljRXF1aXBtZW50OiBzdHJpbmc7XHJcbiAgICByZWd1bGFyRXF1aXBtZW50OiBzdHJpbmc7XHJcbiAgICBqb3VybmFsOiBzdHJpbmc7XHJcbiAgICBub3Rlczogc3RyaW5nO1xyXG4gICAgc3BlbGxib29rOiBTcGVsbGJvb2s7XHJcbiAgICBzcGVsbHNsb3RzOiBTcGVsbHNsb3RzO1xyXG4gICAgdHJlYXN1cmU6IFRyZWFzdXJlO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU3BlbGxib29rIHtcclxuICAgIHNwZWxsczE6IHN0cmluZztcclxuICAgIHNwZWxsczI6IHN0cmluZztcclxuICAgIHNwZWxsczM6IHN0cmluZztcclxuICAgIHNwZWxsczQ6IHN0cmluZztcclxuICAgIHNwZWxsczU6IHN0cmluZztcclxuICAgIHNwZWxsczY6IHN0cmluZztcclxuICAgIHNwZWxsczc6IHN0cmluZztcclxuICAgIHNwZWxsczg6IHN0cmluZztcclxuICAgIHNwZWxsczk6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFNwZWxsc2xvdHMge1xyXG4gICAgc3BlbGxzMTogc3RyaW5nO1xyXG4gICAgc3BlbGxzMjogc3RyaW5nO1xyXG4gICAgc3BlbGxzMzogc3RyaW5nO1xyXG4gICAgc3BlbGxzNDogc3RyaW5nO1xyXG4gICAgc3BlbGxzNTogc3RyaW5nO1xyXG4gICAgc3BlbGxzNjogc3RyaW5nO1xyXG4gICAgc3BlbGxzNzogc3RyaW5nO1xyXG4gICAgc3BlbGxzODogc3RyaW5nO1xyXG4gICAgc3BlbGxzOTogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHJlYXN1cmUge1xyXG4gICAgcHA6IG51bWJlcjtcclxuICAgIGdwOiBudW1iZXI7XHJcbiAgICBlcDogbnVtYmVyO1xyXG4gICAgc3A6IG51bWJlcjtcclxuICAgIGNwOiBudW1iZXI7XHJcbiAgICBpdGVtczogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgV2VhcG9uIHtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIHJhbmdlOiBzdHJpbmc7XHJcbiAgICBkYW1hZ2U6IHN0cmluZztcclxuICAgIGF0dGFjazogc3RyaW5nO1xyXG59Il19