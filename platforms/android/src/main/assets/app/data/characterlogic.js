"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var metadatasource_1 = require("./metadatasource");
var CharacterLogic = (function () {
    function CharacterLogic(character) {
        var _this = this;
        this.getAttributeModifier = function (attribute) {
            var attrValue;
            if (attribute == null || _this.character == null)
                return 0;
            if (_this.character[attribute] == null)
                return 0;
            attrValue = _this.character[attribute];
            if (typeof (attrValue) == "string")
                attrValue = parseInt(attrValue);
            switch (attrValue) {
                case 2:
                case 3:
                    return -3;
                case 4:
                case 5:
                    return -2;
                case 6:
                case 7:
                case 8:
                    return -1;
                case 9:
                case 10:
                case 11:
                case 12:
                    return 0;
                case 13:
                case 14:
                case 15:
                    return 1;
                case 16:
                case 17:
                    return 2;
                case 18:
                    return 3;
                default:
                    return 0;
            }
        };
        this.getTHAC0 = function () {
            var level = _this.character.level;
            switch (_this.character.class) {
                case metadatasource_1.Class.Fighter:
                case metadatasource_1.Class.Dwarf:
                case metadatasource_1.Class.Elf:
                case metadatasource_1.Class.Halfling:
                    return 19 - (Math.ceil(level / 3) - 1) * 2;
                case metadatasource_1.Class.Cleric:
                case metadatasource_1.Class.Thief:
                    return 19 - (Math.ceil(level / 4) - 1) * 2;
                case metadatasource_1.Class.MagicUser:
                    return 19 - (Math.ceil(level / 5) - 1) * 2;
                default:
                    return 19;
            }
        };
        this.getAttackBonus = function () {
            return 20 - _this.getTHAC0();
        };
        this.getReverseAC = function () {
            return 20 - _this.character.ac;
        };
        this.isValidLevel = function (level) {
            if (level < 1)
                return false;
            return level <= _this.getMaxLevel();
        };
        this.getMaxLevel = function () {
            switch (_this.character.class) {
                case metadatasource_1.Class.Dwarf:
                    return 12;
                case metadatasource_1.Class.Elf:
                    return 10;
                case metadatasource_1.Class.Halfling:
                    return 8;
                case metadatasource_1.Class.Cleric:
                case metadatasource_1.Class.Fighter:
                case metadatasource_1.Class.MagicUser:
                case metadatasource_1.Class.Thief:
                    return 36;
            }
            return 36;
        };
        this.getClasses = function () {
            return metadatasource_1.MetaDataService.getClasses();
        };
        this.getSave = function (saveType) {
            return metadatasource_1.MetaDataService.getSaves(_this.character.class, _this.character.level, saveType);
        };
        this.getSpellSlots = function (spellLevel) {
            return metadatasource_1.MetaDataService.getSpellSlots(_this.character.class, _this.character.level, spellLevel);
        };
        this.character = character;
    }
    return CharacterLogic;
}());
exports.CharacterLogic = CharacterLogic;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcmFjdGVybG9naWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjaGFyYWN0ZXJsb2dpYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLG1EQUFvRTtBQUVwRTtJQUdJLHdCQUFZLFNBQW9CO1FBQWhDLGlCQUVDO1FBRUQseUJBQW9CLEdBQUcsVUFBQyxTQUFpQjtZQUNyQyxJQUFJLFNBQWlCLENBQUM7WUFFdEIsRUFBRSxDQUFBLENBQUMsU0FBUyxJQUFJLElBQUksSUFBSSxLQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQztnQkFDM0MsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNiLEVBQUUsQ0FBQSxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDO2dCQUNqQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2IsU0FBUyxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdEMsRUFBRSxDQUFBLENBQUMsT0FBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLFFBQVEsQ0FBQztnQkFDN0IsU0FBUyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUEsQ0FBQyxTQUFTLENBQUMsQ0FDakIsQ0FBQztnQkFDRyxLQUFLLENBQUMsQ0FBQztnQkFDUCxLQUFLLENBQUM7b0JBQ0YsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNkLEtBQUssQ0FBQyxDQUFDO2dCQUNQLEtBQUssQ0FBQztvQkFDRixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2QsS0FBSyxDQUFDLENBQUM7Z0JBQ1AsS0FBSyxDQUFDLENBQUM7Z0JBQ1AsS0FBSyxDQUFDO29CQUNGLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDZCxLQUFLLENBQUMsQ0FBQztnQkFDUCxLQUFLLEVBQUUsQ0FBQztnQkFDUixLQUFLLEVBQUUsQ0FBQztnQkFDUixLQUFLLEVBQUU7b0JBQ0gs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LENBQUMsQ0FBQTtRQUVELFlBQU8sR0FBRyxVQUFDLFFBQWtCO1lBQ3pCLE1BQU0sQ0FBQyxnQ0FBZSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxLQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMxRixDQUFDLENBQUE7UUFFRCxrQkFBYSxHQUFHLFVBQUMsVUFBa0I7WUFDL0IsTUFBTSxDQUFDLGdDQUFlLENBQUMsYUFBYSxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLEtBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ2pHLENBQUMsQ0FBQTtRQXZHRyxJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztJQUMvQixDQUFDO0lBdUdMLHFCQUFDO0FBQUQsQ0FBQyxBQTVHRCxJQTRHQztBQTVHWSx3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYXJhY3RlciB9IGZyb20gJy4vZGF0YXNvdXJjZSc7XHJcbmltcG9ydCB7IENsYXNzLCBTYXZlVHlwZSwgTWV0YURhdGFTZXJ2aWNlIH0gZnJvbSAnLi9tZXRhZGF0YXNvdXJjZSc7XHJcblxyXG5leHBvcnQgY2xhc3MgQ2hhcmFjdGVyTG9naWMge1xyXG4gICAgcHJpdmF0ZSBjaGFyYWN0ZXI6IENoYXJhY3RlcjtcclxuICAgIFxyXG4gICAgY29uc3RydWN0b3IoY2hhcmFjdGVyOiBDaGFyYWN0ZXIpIHtcclxuICAgICAgICB0aGlzLmNoYXJhY3RlciA9IGNoYXJhY3RlcjtcclxuICAgIH1cclxuICAgICAgIFxyXG4gICAgZ2V0QXR0cmlidXRlTW9kaWZpZXIgPSAoYXR0cmlidXRlOiBzdHJpbmcpOiBudW1iZXIgPT4ge1xyXG4gICAgICAgIGxldCBhdHRyVmFsdWU6IG51bWJlcjtcclxuXHJcbiAgICAgICAgaWYoYXR0cmlidXRlID09IG51bGwgfHwgdGhpcy5jaGFyYWN0ZXIgPT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgaWYodGhpcy5jaGFyYWN0ZXJbYXR0cmlidXRlXSA9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICBhdHRyVmFsdWUgPSB0aGlzLmNoYXJhY3RlclthdHRyaWJ1dGVdO1xyXG4gICAgICAgIGlmKHR5cGVvZihhdHRyVmFsdWUpID09IFwic3RyaW5nXCIpXHJcbiAgICAgICAgICAgIGF0dHJWYWx1ZSA9IHBhcnNlSW50KGF0dHJWYWx1ZSk7XHJcbiAgICAgICAgc3dpdGNoKGF0dHJWYWx1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0zO1xyXG4gICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgIGNhc2UgNTpcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMjtcclxuICAgICAgICAgICAgY2FzZSA2OlxyXG4gICAgICAgICAgICBjYXNlIDc6XHJcbiAgICAgICAgICAgIGNhc2UgODpcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgY2FzZSA5OlxyXG4gICAgICAgICAgICBjYXNlIDEwOlxyXG4gICAgICAgICAgICBjYXNlIDExOlxyXG4gICAgICAgICAgICBjYXNlIDEyOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIGNhc2UgMTM6XHJcbiAgICAgICAgICAgIGNhc2UgMTQ6XHJcbiAgICAgICAgICAgIGNhc2UgMTU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgY2FzZSAxNjpcclxuICAgICAgICAgICAgY2FzZSAxNzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAyO1xyXG4gICAgICAgICAgICBjYXNlIDE4OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDM7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VEhBQzAgPSAoKSA9PiB7XHJcbiAgICAgICAgbGV0IGxldmVsID0gdGhpcy5jaGFyYWN0ZXIubGV2ZWw7XHJcbiAgICAgICAgc3dpdGNoKHRoaXMuY2hhcmFjdGVyLmNsYXNzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRmlnaHRlcjpcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5Ed2FyZjpcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5FbGY6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuSGFsZmxpbmc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTkgLSAoTWF0aC5jZWlsKGxldmVsIC8gMykgLSAxKSAqIDI7XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuQ2xlcmljOlxyXG4gICAgICAgICAgICBjYXNlIENsYXNzLlRoaWVmOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE5IC0gKE1hdGguY2VpbChsZXZlbCAvIDQpIC0gMSkgKiAyO1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLk1hZ2ljVXNlcjpcclxuICAgICAgICAgICAgICAgIHJldHVybiAxOSAtIChNYXRoLmNlaWwobGV2ZWwgLyA1KSAtIDEpICogMjtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiAxOTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QXR0YWNrQm9udXMgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIDIwIC0gdGhpcy5nZXRUSEFDMCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFJldmVyc2VBQyA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4gMjAgLSB0aGlzLmNoYXJhY3Rlci5hYztcclxuICAgIH1cclxuXHJcbiAgICBpc1ZhbGlkTGV2ZWwgPSAobGV2ZWw6IG51bWJlcik6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgIGlmKGxldmVsIDwgMSlcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIHJldHVybiBsZXZlbCA8PSB0aGlzLmdldE1heExldmVsKClcclxuICAgIH1cclxuXHJcbiAgICBnZXRNYXhMZXZlbCA9ICgpID0+IHtcclxuICAgICAgICBzd2l0Y2godGhpcy5jaGFyYWN0ZXIuY2xhc3MpIHsgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRHdhcmY6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTI7XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRWxmOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDEwO1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkhhbGZsaW5nOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDg7XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuQ2xlcmljOlxyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkZpZ2h0ZXI6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuTWFnaWNVc2VyOlxyXG4gICAgICAgICAgICBjYXNlIENsYXNzLlRoaWVmOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDM2O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gMzY7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2xhc3NlcyA9ICgpOiBzdHJpbmdbXSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIE1ldGFEYXRhU2VydmljZS5nZXRDbGFzc2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2F2ZSA9IChzYXZlVHlwZTogU2F2ZVR5cGUpOiBudW1iZXIgPT4ge1xyXG4gICAgICAgIHJldHVybiBNZXRhRGF0YVNlcnZpY2UuZ2V0U2F2ZXModGhpcy5jaGFyYWN0ZXIuY2xhc3MsIHRoaXMuY2hhcmFjdGVyLmxldmVsLCBzYXZlVHlwZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U3BlbGxTbG90cyA9IChzcGVsbExldmVsOiBudW1iZXIpOiBudW1iZXIgPT4ge1xyXG4gICAgICAgIHJldHVybiBNZXRhRGF0YVNlcnZpY2UuZ2V0U3BlbGxTbG90cyh0aGlzLmNoYXJhY3Rlci5jbGFzcywgdGhpcy5jaGFyYWN0ZXIubGV2ZWwsIHNwZWxsTGV2ZWwpO1xyXG4gICAgfVxyXG59Il19