"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var saves_1 = require("./resources/saves");
var classes_1 = require("./resources/classes");
var spells_1 = require("./resources/spells");
var abilities_1 = require("./resources/abilities");
var MetaDataService = (function () {
    function MetaDataService() {
    }
    MetaDataService.prototype.FormatString = function (format) {
        var args = Array.prototype.slice.call(arguments, 1);
        return format.replace(/{(\d+)}/g, function (match, number) {
            return typeof args[number] != 'undefined' ? args[number] : match;
        });
    };
    return MetaDataService;
}());
MetaDataService.getClasses = function () {
    return classes_1.Classes;
};
MetaDataService.getSaves = function (classEnum, level, saveType) {
    var index = 0;
    if (saves_1.Saves[classEnum] == null)
        return 0;
    switch (classEnum) {
        case Class.Fighter:
        case Class.Dwarf:
        case Class.Elf:
        case Class.Halfling:
            index = Math.ceil(level / 3) - 1;
            break;
        case Class.Cleric:
        case Class.Thief:
            index = Math.ceil(level / 4) - 1;
            break;
        case Class.MagicUser:
            index = Math.ceil(level / 5) - 1;
            break;
    }
    if (saves_1.Saves[classEnum][index] == null)
        return 0;
    return saves_1.Saves[classEnum][index][saveType];
};
MetaDataService.getSpellSlots = function (classEnum, characterLevel, spellLevel) {
    var slots = 0;
    var spells;
    switch (classEnum) {
        case Class.Fighter:
        case Class.Dwarf:
        case Class.Thief:
        case Class.Halfling:
            return 0;
        case Class.Cleric:
        case Class.Elf:
        case Class.MagicUser:
            spells = spells_1.SpellsSlots[classEnum];
            if (spells == null)
                return 0;
            if (spells[characterLevel] == null)
                slots = spells[spells.length - 1][spellLevel];
            else
                slots = spells[characterLevel][spellLevel];
            break;
    }
    if (slots == null)
        slots = 0;
    return slots;
};
MetaDataService.getAbilities = function (classEnum, characterLevel) {
    var abilities = new Array();
    var abilityTemplates;
    var abilityTemplate;
    var text;
    var titles;
    var inputs;
    if ((abilities_1.Abilities[classEnum] == null) || (abilities_1.Abilities[classEnum].length == 0))
        return abilities;
    abilityTemplates = abilities_1.Abilities[classEnum].filter((function (abilityTemplate) { return abilityTemplate.level <= characterLevel; }), characterLevel);
    for (var i = 0; i < abilityTemplates.length; ++i) {
        abilityTemplate = abilityTemplates[i];
        text = abilityTemplate.text;
        if (abilityTemplate.table != null && abilityTemplate.table.length > 0) {
            titles = abilityTemplate.table[0];
            inputs = abilityTemplate.table[characterLevel];
            for (var j = 0; j < titles.length; ++j) {
                text += "\n";
                text += titles[j] + ": " + inputs[j];
            }
        }
        abilities.push(new Ability(abilityTemplate.title, text));
    }
    return abilities;
};
exports.MetaDataService = MetaDataService;
var Ability = (function () {
    function Ability(title, text) {
        this.title = title;
        this.text = text;
    }
    return Ability;
}());
exports.Ability = Ability;
var Class;
(function (Class) {
    Class[Class["Cleric"] = 0] = "Cleric";
    Class[Class["Fighter"] = 1] = "Fighter";
    Class[Class["MagicUser"] = 2] = "MagicUser";
    Class[Class["Thief"] = 3] = "Thief";
    Class[Class["Dwarf"] = 4] = "Dwarf";
    Class[Class["Elf"] = 5] = "Elf";
    Class[Class["Halfling"] = 6] = "Halfling";
})(Class = exports.Class || (exports.Class = {}));
var SaveType;
(function (SaveType) {
    SaveType[SaveType["DeathRay"] = 0] = "DeathRay";
    SaveType[SaveType["Wand"] = 1] = "Wand";
    SaveType[SaveType["Paralysis"] = 2] = "Paralysis";
    SaveType[SaveType["DragonBreath"] = 3] = "DragonBreath";
    SaveType[SaveType["RodStaffSpell"] = 4] = "RodStaffSpell";
})(SaveType = exports.SaveType || (exports.SaveType = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGFzb3VyY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtZXRhZGF0YXNvdXJjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDJDQUF5QztBQUN6QywrQ0FBNkM7QUFDN0MsNkNBQWdEO0FBQ2hELG1EQUFpRDtBQUVqRDtJQUFBO0lBMkZBLENBQUM7SUFORyxzQ0FBWSxHQUFaLFVBQWEsTUFBYztRQUN2QixJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxVQUFTLEtBQUssRUFBRSxNQUFNO1lBQ3BELE1BQU0sQ0FBQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUNyRSxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDTCxzQkFBQztBQUFELENBQUMsQUEzRkQ7QUFFVywwQkFBVSxHQUFHO0lBQ2hCLE1BQU0sQ0FBQyxpQkFBTyxDQUFDO0FBQ25CLENBQUMsQ0FBQTtBQUVNLHdCQUFRLEdBQUcsVUFBQyxTQUFnQixFQUFFLEtBQWEsRUFBRSxRQUFrQjtJQUNsRSxJQUFJLEtBQUssR0FBVyxDQUFDLENBQUM7SUFFdEIsRUFBRSxDQUFBLENBQUMsYUFBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksQ0FBQztRQUN4QixNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ2IsTUFBTSxDQUFBLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNmLEtBQUssS0FBSyxDQUFDLE9BQU8sQ0FBQztRQUNuQixLQUFLLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDakIsS0FBSyxLQUFLLENBQUMsR0FBRyxDQUFDO1FBQ2YsS0FBSyxLQUFLLENBQUMsUUFBUTtZQUNmLEtBQUss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QztBQVBZLDBCQUFPO0FBU3BCLElBQVksS0FFWDtBQUZELFdBQVksS0FBSztJQUNiLHFDQUFNLENBQUE7SUFBRSx1Q0FBTyxDQUFBO0lBQUUsMkNBQVMsQ0FBQTtJQUFFLG1DQUFLLENBQUE7SUFBRSxtQ0FBSyxDQUFBO0lBQUUsK0JBQUcsQ0FBQTtJQUFFLHlDQUFRLENBQUE7QUFDM0QsQ0FBQyxFQUZXLEtBQUssR0FBTCxhQUFLLEtBQUwsYUFBSyxRQUVoQjtBQUVELElBQVksUUFFWDtBQUZELFdBQVksUUFBUTtJQUNoQiwrQ0FBUSxDQUFBO0lBQUUsdUNBQUksQ0FBQTtJQUFFLGlEQUFTLENBQUE7SUFBRSx1REFBWSxDQUFBO0lBQUMseURBQWEsQ0FBQTtBQUN6RCxDQUFDLEVBRlcsUUFBUSxHQUFSLGdCQUFRLEtBQVIsZ0JBQVEsUUFFbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFNhdmVzIH0gZnJvbSAnLi9yZXNvdXJjZXMvc2F2ZXMnXHJcbmltcG9ydCB7IENsYXNzZXMgfSBmcm9tICcuL3Jlc291cmNlcy9jbGFzc2VzJ1xyXG5pbXBvcnQgeyBTcGVsbHNTbG90cyB9IGZyb20gJy4vcmVzb3VyY2VzL3NwZWxscydcclxuaW1wb3J0IHsgQWJpbGl0aWVzIH0gZnJvbSAnLi9yZXNvdXJjZXMvYWJpbGl0aWVzJ1xyXG5cclxuZXhwb3J0IGNsYXNzIE1ldGFEYXRhU2VydmljZSB7XHJcbiAgICBcclxuICAgIHN0YXRpYyBnZXRDbGFzc2VzID0gKCk6IHN0cmluZ1tdID0+IHtcclxuICAgICAgICByZXR1cm4gQ2xhc3NlcztcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0U2F2ZXMgPSAoY2xhc3NFbnVtOiBDbGFzcywgbGV2ZWw6IG51bWJlciwgc2F2ZVR5cGU6IFNhdmVUeXBlKTogbnVtYmVyID0+IHtcclxuICAgICAgICBsZXQgaW5kZXg6IG51bWJlciA9IDA7XHJcblxyXG4gICAgICAgIGlmKFNhdmVzW2NsYXNzRW51bV0gPT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgc3dpdGNoKGNsYXNzRW51bSkge1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkZpZ2h0ZXI6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRHdhcmY6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRWxmOlxyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkhhbGZsaW5nOlxyXG4gICAgICAgICAgICAgICAgaW5kZXggPSBNYXRoLmNlaWwobGV2ZWwgLyAzKSAtIDE7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5DbGVyaWM6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuVGhpZWY6XHJcbiAgICAgICAgICAgICAgICBpbmRleCA9IE1hdGguY2VpbChsZXZlbCAvIDQpIC0gMTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLk1hZ2ljVXNlcjpcclxuICAgICAgICAgICAgICAgIGluZGV4ID0gTWF0aC5jZWlsKGxldmVsIC8gNSkgLSAxO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKFNhdmVzW2NsYXNzRW51bV1baW5kZXhdID09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIHJldHVybiBTYXZlc1tjbGFzc0VudW1dW2luZGV4XVtzYXZlVHlwZV07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldFNwZWxsU2xvdHMgPSAoY2xhc3NFbnVtOiBDbGFzcywgY2hhcmFjdGVyTGV2ZWw6IG51bWJlciwgc3BlbGxMZXZlbDogbnVtYmVyKTogbnVtYmVyID0+IHtcclxuICAgICAgICBsZXQgc2xvdHM6IG51bWJlciA9IDA7XHJcbiAgICAgICAgbGV0IHNwZWxsczogbnVtYmVyW11bXTtcclxuXHJcbiAgICAgICAgc3dpdGNoKGNsYXNzRW51bSkge1xyXG4gICAgICAgICAgICBjYXNlIENsYXNzLkZpZ2h0ZXI6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRHdhcmY6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuVGhpZWY6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuSGFsZmxpbmc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgY2FzZSBDbGFzcy5DbGVyaWM6XHJcbiAgICAgICAgICAgIGNhc2UgQ2xhc3MuRWxmOlxyXG4gICAgICAgICAgICBjYXNlIENsYXNzLk1hZ2ljVXNlcjpcclxuICAgICAgICAgICAgICAgIHNwZWxscyA9IFNwZWxsc1Nsb3RzW2NsYXNzRW51bV07XHJcbiAgICAgICAgICAgICAgICBpZihzcGVsbHMgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgICAgIGlmKHNwZWxsc1tjaGFyYWN0ZXJMZXZlbF0gPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBzbG90cyA9IHNwZWxsc1tzcGVsbHMubGVuZ3RoIC0gMV1bc3BlbGxMZXZlbF07XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgc2xvdHMgPSBzcGVsbHNbY2hhcmFjdGVyTGV2ZWxdW3NwZWxsTGV2ZWxdO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHNsb3RzID09IG51bGwpXHJcbiAgICAgICAgICAgIHNsb3RzID0gMDtcclxuICAgICAgICByZXR1cm4gc2xvdHM7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldEFiaWxpdGllcyA9IChjbGFzc0VudW06IENsYXNzLCBjaGFyYWN0ZXJMZXZlbDogbnVtYmVyKTogQWJpbGl0eVtdID0+IHtcclxuICAgICAgICBsZXQgYWJpbGl0aWVzID0gbmV3IEFycmF5PEFiaWxpdHk+KCk7XHJcbiAgICAgICAgbGV0IGFiaWxpdHlUZW1wbGF0ZXM7XHJcbiAgICAgICAgbGV0IGFiaWxpdHlUZW1wbGF0ZTtcclxuICAgICAgICBsZXQgdGV4dDogc3RyaW5nO1xyXG4gICAgICAgIGxldCB0aXRsZXM6IHN0cmluZ1tdO1xyXG4gICAgICAgIGxldCBpbnB1dHM6IHN0cmluZ1tdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKChBYmlsaXRpZXNbY2xhc3NFbnVtXSA9PSBudWxsKSB8fCAoQWJpbGl0aWVzW2NsYXNzRW51bV0ubGVuZ3RoID09IDApKVxyXG4gICAgICAgICAgICByZXR1cm4gYWJpbGl0aWVzO1xyXG4gICAgICAgIGFiaWxpdHlUZW1wbGF0ZXMgPSBBYmlsaXRpZXNbY2xhc3NFbnVtXS5maWx0ZXIoKChhYmlsaXR5VGVtcGxhdGUpID0+IGFiaWxpdHlUZW1wbGF0ZS5sZXZlbCA8PSBjaGFyYWN0ZXJMZXZlbCksIGNoYXJhY3RlckxldmVsKTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgYWJpbGl0eVRlbXBsYXRlcy5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBhYmlsaXR5VGVtcGxhdGUgPSBhYmlsaXR5VGVtcGxhdGVzW2ldO1xyXG4gICAgICAgICAgICB0ZXh0ID0gYWJpbGl0eVRlbXBsYXRlLnRleHQ7XHJcbiAgICAgICAgICAgIGlmKGFiaWxpdHlUZW1wbGF0ZS50YWJsZSAhPSBudWxsICYmIGFiaWxpdHlUZW1wbGF0ZS50YWJsZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZXMgPSBhYmlsaXR5VGVtcGxhdGUudGFibGVbMF07XHJcbiAgICAgICAgICAgICAgICBpbnB1dHMgPSBhYmlsaXR5VGVtcGxhdGUudGFibGVbY2hhcmFjdGVyTGV2ZWxdO1xyXG4gICAgICAgICAgICAgICAgZm9yKGxldCBqID0gMDsgaiA8IHRpdGxlcy5sZW5ndGg7ICsraikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQgKz0gXCJcXG5cIjtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IHRpdGxlc1tqXSArIFwiOiBcIiArIGlucHV0c1tqXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhYmlsaXRpZXMucHVzaChuZXcgQWJpbGl0eShhYmlsaXR5VGVtcGxhdGUudGl0bGUsIHRleHQpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFiaWxpdGllcztcclxuICAgIH1cclxuXHJcbiAgICBGb3JtYXRTdHJpbmcoZm9ybWF0OiBzdHJpbmcpIHtcclxuICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XHJcbiAgICAgICAgcmV0dXJuIGZvcm1hdC5yZXBsYWNlKC97KFxcZCspfS9nLCBmdW5jdGlvbihtYXRjaCwgbnVtYmVyKSB7IFxyXG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIGFyZ3NbbnVtYmVyXSAhPSAndW5kZWZpbmVkJyA/IGFyZ3NbbnVtYmVyXSA6IG1hdGNoO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQWJpbGl0eSB7XHJcbiAgICBjb25zdHJ1Y3Rvcih0aXRsZTogc3RyaW5nLCB0ZXh0OnN0cmluZykge1xyXG4gICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcclxuICAgICAgICB0aGlzLnRleHQgPSB0ZXh0O1xyXG4gICAgfVxyXG4gICAgdGl0bGU6IHN0cmluZztcclxuICAgIHRleHQ6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGVudW0gQ2xhc3Mge1xyXG4gICAgQ2xlcmljLCBGaWdodGVyLCBNYWdpY1VzZXIsIFRoaWVmLCBEd2FyZiwgRWxmLCBIYWxmbGluZ1xyXG59XHJcblxyXG5leHBvcnQgZW51bSBTYXZlVHlwZSB7XHJcbiAgICBEZWF0aFJheSwgV2FuZCwgUGFyYWx5c2lzLCBEcmFnb25CcmVhdGgsUm9kU3RhZmZTcGVsbFxyXG59Il19